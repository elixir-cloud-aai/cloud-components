<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./logo-elixir-cloud-aai.svg" type="image/x-icon" />
    <title>ecc-utils-design</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      ecc-utils-design-collection {
        --ecc-corner: 0.5rem;
      }
    </style>
  </head>
  <body>
    <div class="p-10">
      <div id="demo"></div>
    </div>

    <script type="module">
      import { html, render } from "lit";
      import { repeat } from "lit/directives/repeat.js";
      import "../../dist/components/collection/index.js";

      // new documentation
      // add functionaility for url pagination in footer

      const fetchDummyData = async (page, limit, searchString, tags) => {
        const res = await fetch(
          `https://jsonplaceholder.typicode.com/comments?_page=${page}&_limit=${limit}${
            searchString ? `&title_like=${searchString}` : ""
          }${tags ? `&completed=${tags === "SUCCESS"}` : ""}`
        );
        const data = await res.json();
        return data;
      };

      const dataInitial = await fetchDummyData(1, 20);

      render(
        html`<ecc-d-collection filter search page-length="2">
          <ecc-d-collection-header>
            <ecc-d-collection-filter
              auto-option
              multiple
              type="select"
              @ecc-input=${(e) => {
                console.log("changing from the top", e);
              }}
            >
            </ecc-d-collection-filter>
          </ecc-d-collection-header>

          <div ecc-collection-body>
            ${repeat(
              dataInitial,
              (item) =>
                html`
                  <ecc-d-collection-item
                    lazy-content
                    name=${item.name}
                    key=${item.id}
                    tag=${parseInt(item.id, 10) % 2 === 0
                      ? "DANGER"
                      : "SUCCESS"}
                    tag-type=${parseInt(item.id, 10) % 2 === 0
                      ? "danger"
                      : "success"}
                    @ecc-expand=${async (e) => {
                      const comment = await fetch(
                        `https://jsonplaceholder.typicode.com/comments/${e.detail.key}`
                      ).then((response) => response.json());

                      e.target.renderContent(e.detail.key, comment.body);
                    }}
                  >
                  </ecc-d-collection-item>
                `
            )}

            <ecc-d-collection-item
              key="item"
              name="item"
              tag="ERROR"
              @ecc-expand=${(e) => {
                e.target.renderContent();
                // e.target.error("random error");
              }}
            >
              Title: Item without lazy loading
            </ecc-d-collection-item>
          </div>
          <ecc-d-collection-footer
            page="2"
            @ecc-utils-page-change=${() => {
              console.log("page changed");
            }}
          ></ecc-d-collection-footer>
        </ecc-d-collection>`,
        document.querySelector("#demo")
      );
    </script>
  </body>
</html>
